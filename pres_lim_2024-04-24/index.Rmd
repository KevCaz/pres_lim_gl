---
title: "Estimation of Food Webs Interactions with Linear Inverse Models"
author: "Kevin Cazelles et al."
date: "2024-04-24"
output:
  xaringan::moon_reader:
    css: [default, rd.css, rd-font.css, "hygge"]
    lib_dir: assets
    seal: false
    nature:
      highlightStyle: dracula
      countIncrementalSlides: false
      beforeInit: "macros.js"
---


class: title-slide, middle


# Estimation of Food Webs Interactions with Linear Inverse Models

.instructors[
  .font180[**Kevin Cazelles, Kevin McCann & Kayla Hale**]
  <br><br>
  .font120[2024-04-24]
]


<div class="logo">
<img src="img/logo_cfem.png" height="100px"></img>
<img src="img/logo_uog.jpg" height="120px"></img>
</div>

```{r setup, include = FALSE}
library(iseWorkshops)
```

---
class: inverse, center, middle

# Introduction

![:custom_hr]()


---
# Linear Inverse Models

### Solve systems of equalities, inequalities and approximations


.pull-left[

$$\mathbf{E} \mathbf{x} = \mathbf{f}$$

$$\mathbf{E} \mathbf{x} \approx \mathbf{b}$$

$$\mathbf{E} \mathbf{x} \geq \mathbf{g}$$

]

---
# Linear Inverse Models


### Solve systems of equalities, inequalities and approximations


.pull-left[

$$\mathbf{E} \color{red}{\mathbf{x}} = \mathbf{f}$$

$$\mathbf{E} \color{red}{\mathbf{x}} \approx \mathbf{b}$$

$$\mathbf{E} \color{red}{\mathbf{x}} \geq \mathbf{g}$$

]


---
# Linear Inverse Models


### Solve systems of equalities, inequalities and approximations


.pull-left[

$$\mathbf{E} \color{red}{\mathbf{x}} = \mathbf{f}$$

$$\mathbf{E} \color{red}{\mathbf{x}} \approx \mathbf{b}$$

$$\mathbf{E} \color{red}{\mathbf{x}} \geq \mathbf{g}$$

]


.pull-right[

$$2\color{red}{x} = 12$$

</br>

$$2\color{red}{x} + \color{red}{y} = 12$$

2 unknown variables, 1 equality

]


---
# Linear Inverse Models


### Solve systems of equalities, inequalities and approximations



.pull-left[

$$\mathbf{E} \color{red}{\mathbf{x}} = \mathbf{f}$$

$$\mathbf{E} \color{red}{\mathbf{x}} \approx \mathbf{b}$$

$$\mathbf{E} \color{red}{\mathbf{x}} \geq \mathbf{g}$$

]


.pull-right[

$$2\color{red}{x} = 12$$

</br>

$$\color{red}{y} = 12 - 2\color{red}{x}$$

in other words, a **line** 

]


---
# Linear Inverse Models

### Solve systems of equalities, inequalities and approximations

.pull-left[

$$\mathbf{E} \color{red}{\mathbf{x}} = \mathbf{f}$$

$$\mathbf{E} \color{red}{\mathbf{x}} \approx \mathbf{b}$$

$$\mathbf{E} \color{red}{\mathbf{x}} \geq \mathbf{g}$$

]


.pull-right[

$$2\color{red}{x} = 12$$

</br>

$$2\color{red}{x} + \color{red}{y} = 12$$

$$\color{red}{x} > 0;  \color{red}{y} > 0$$
$$\color{red}{y} < 4 $$
]

all $(\color{red}{x}, \color{red}{y})$ such as $\color{red}{y} = 12 - 2\color{red}{x}$ and $x \in ]4, 6[$ : a **segment**

--
### Large array of problems 

- Optimal transportation, clustering, solving Sudoku, etc.
- `r lk()` https://jump.dev/JuMP.jl/stable/tutorials/linear/diet/


---
# Linear Inverse Models in Food Webs


![:scalec 70%](img/biomass_balance.png)

- `r bk()` Soetaert & Van Oevelen (2009), **Oceanography**. 


???
You may know some flows


---
# Linear Inverse Models in Food Webs

![:scalec 60%](img/simplified_fw.png)

- Biomasses known
- Linear relationships among flux
- `r bk()` Soetaert & Van Oevelen (2009), **Oceanography**. 


---
# Linear Inverse Models in Food Webs

![:scalec 65%](img/constraints.png)

- `r bk()` Soetaert & Van Oevelen (2009), **Oceanography**. 


---
# Linear Inverse Models in Food Webs

![:scalec 75%](img/results.png)

- `r bk()` Soetaert & Van Oevelen (2009), **Oceanography**. 


---
# Linear Inverse Models in Food Webs

## A note about Ecopath

- **Ecopath**: mass balance modelling
- 2 master equations 

```
Production = catch + predation + net migration + 
  biomass accumulation + other mortality

Consumption = production + respiration + unassimilated food
```

- `r lk()` https://ecopath.org/about/#toggle-id-1



---
# Linear Inverse Models in Food Webs

## Let's keep in mind 

1. LIM approach can be used to combine a set of constraints on a mass balance model to estimate the mase/energy flows;

2. the more the constraints, the smaller the solution space.



---

class: inverse, center, middle

# LIM for food web resilience

![:custom_hr]()



---
# LIM in classical Lotka-Volterra

</br>

$$\begin{equation}\begin{aligned}
\frac{dPrey}{dt}      &= Prey \left( r_{Prey} + a_{1, 1} Prey - a_{1, 2} Predator \right) \\
\frac{dPredator}{dt}  &= Predator \left( r_{Predator} + a_{2, 1} Prey \right)
\end{aligned}\end{equation}$$


---
# LIM in classical Lotka-Volterra

</br>

$$\begin{equation}\begin{aligned}
\frac{d\color{red}{Prey}}{dt}      &= \color{red}{Prey} \left( r_{Prey} + a_{1, 1} \color{red}{Prey} - a_{1, 2} \color{red}{Predator} \right) \\
\frac{d\color{red}{Predator}}{dt}  &= \color{red}{Predator} \left( r_{Predator} + a_{2, 1} \color{red}{Prey} \right)
\end{aligned}\end{equation}$$

Classically: 

1. interactions are known 
2. variation of $Predator$ and $Prey$ population (individuals, biomass)
3. study of the stability of the system 


---
# LIM in classical Lotka-Volterra

### Assumptions 

- near equilibrium 
- biomass known

$$\begin{equation}\begin{aligned}
\left( r_{Prey} + a_{1, 1} \color{red}{Prey} - a_{1, 2} \color{red}{Predator} \right) &= 0\\
\left( r_{Predator} + a_{2, 1} \color{red}{Prey} \right) &= 0
\end{aligned}\end{equation}$$


---
# LIM in classical Lotka-Volterra

### Assumptions 

- near equilibrium 
- biomass known

$$\begin{equation}\begin{aligned}
\left( r_{Prey} + \color{red}{a_{1, 1}} Prey - \color{red}{a_{1, 2}} Predator \right) &= 0\\ 
\left( r_{Predator} + \color{red}{a_{2, 1}} Prey \right) &= 0
\end{aligned}\end{equation}$$

- 2 equalities 
- 3 unknown variables


---
# LIM in classical Lotka-Volterra

### Example 

1. Prey and Predator **biomass known**
2. **Interactions are positive** + Prey `r ar()` Predator **<** Prey `r ar()` Predator

![:scalec 67%](img/res-1.png)



---
# LIM in classical Lotka-Volterra

![:scalec 45%](img/compare1-1.png)

???
if stability taken as resilience so..


---
# Using more constraints

![:scalec 70%](img/gellner3.png)


- `r bk()` Gellner, McCann & Hasting (2023), **PNAS**. 


???
it is a very hopeful results if you use constraints interaction inference 
may be doable


---

class: inverse, center, middle

# Solving management challenges with LIM 

![:custom_hr]()

???
go over various potential avenues where we can use lim


---
# A five species example

.pull-left[
![:scalec 50%](img/net5.png)

- 5 species, 10 interactions
- **assumptions**:
  - Lotka-Volterra
  - biomass/population known 
- **constraints**: 
  - interactions are positive and asymmetrical
]

.pull-right[
.font50[
|Symbol        | Name                        |
|:------------ |:--------------------------- |
|$$a_{1, 1}$$   | intraspecific competition  |
|$$a_{1, 3}$$   | prey -> predator           |
|$$a_{2, 2}$$   | intraspecific competition  |
|$$a_{2, 4}$$   | prey -> predator           |
|$$a_{3, 1}$$   | predator <- prey           |
|$$a_{3, 5}$$   | predator -> top predator           |
|$$a_{4, 2}$$   | predator <- prey           |
|$$a_{4, 5}$$   | predator -> top predator   |
|$$a_{5, 3}$$   | top predator <- predator   |
|$$a_{5, 4}$$   | top predator <- predator   |
]

]

---
# A five species example - resilience 

![:scalec 85%](img/boxplot-1.png)


---
# A five species example - resilience 

![:scalec 60%](img/dynamic_5.png)


---
# Setting a<sub>5,3</sub> to a constant


![:scalec 80%](img/boxplot_one_less.png)


???
decreasing unknown 

---
# Setting a<sub>5,3</sub> to a constant


![:scalec 50%](img/boxplot_one_less_stab.png)



---
# Refining energy constraints

![:scalec 78%](img/change_energy_constraints.png)


---
# Refining energy constraints

![:scalec 50%](img/change_energy_constraints_stab.png)



---
# Most stable vs. least stable 

![:scalec 80%](img/most_25.png)


---
# Most stable vs. least stable

![:scalec 80%](img/most_10.png)


---
# Increasing a<sub>3,1</sub>

![:scalec 80%](img/increase_a_3_1.png)

---
# Increasing a<sub>3,1</sub>

![:scalec 45%](img/increase_a_3_1_full.png)



---
# Increasing top predator biomass

![:scalec 85%](img/increase_tp_biomass.png)


???
we get the full portray
till here we had the biomass fix

---
# Increasing top predator biomass

![:scalec 50%](img/increase_tp_biomass_stab.png)



---
# Analyzing temporal variation 

![:scalec 95%](img/ts_3phases.png)


---
# Analyzing temporal variation 

![:scalec 85%](img/drawing_ts.png)


---
# Analyzing temporal variation 

![:scalec 90%](img/3phases_all.png)



---
# Analyzing temporal variation 

![:scalec 60%](img/3phases_all_stab.png)





---
# Future Challenges 


## A flexible tools to add constraints 

- allometric constraints (previous presentation)
- constraints based on time series (variation of biomass)
- working on a R package

--

## Work on real food webs 

- This requires **data** (next presentation)
  - food webs topology  (spatially explicit)
  - biomass time series
  - interactions constrains 
 



---
class: inverse, center, middle

# Interactive tool (Shiny App)

![:custom_hr]()




<!-- demo here 5-10 min -->
